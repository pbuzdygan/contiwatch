<!doctype html>
<html lang="en" data-theme="auto" data-density="comfortable">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Contiwatch — UI mockup (Command Center)</title>
    <style>
      :root {
        /* Modern token set (minimal + consistent) */
        --radius-s: 10px;
        --radius: 14px;
        --radius-l: 18px;
        --control-h: 40px;
        --space-1: 6px;
        --space-2: 10px;
        --space-3: 14px;
        --space-4: 18px;
        --shadow: 0 18px 55px rgba(0, 0, 0, 0.42);

        /* Brand / accent (intentionally new) */
        --brand: #7c3aed; /* violet */
        --brand-2: #06b6d4; /* cyan */
        --good: #22c55e;
        --warn: #f59e0b;
        --bad: #ef4444;

        /* Dark default */
        --bg: #05070d;
        --panel: rgba(255, 255, 255, 0.06);
        --panel-2: rgba(255, 255, 255, 0.04);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.64);
        --border: rgba(255, 255, 255, 0.12);
        --ring: rgba(6, 182, 212, 0.28);
      }

      @media (prefers-color-scheme: light) {
        :root {
          --bg: #f7f8fb;
          --panel: rgba(255, 255, 255, 0.92);
          --panel-2: rgba(255, 255, 255, 0.72);
          --text: #0b1020;
          --muted: rgba(11, 16, 32, 0.60);
          --border: rgba(11, 16, 32, 0.12);
          --shadow: 0 18px 45px rgba(0, 0, 0, 0.12);
          --ring: rgba(124, 58, 237, 0.20);
        }
      }

      html[data-theme="light"] body {
        --bg: #f7f8fb;
        --panel: rgba(255, 255, 255, 0.92);
        --panel-2: rgba(255, 255, 255, 0.72);
        --text: #0b1020;
        --muted: rgba(11, 16, 32, 0.60);
        --border: rgba(11, 16, 32, 0.12);
        --shadow: 0 18px 45px rgba(0, 0, 0, 0.12);
        --ring: rgba(124, 58, 237, 0.20);
        color-scheme: light;
      }
      html[data-theme="dark"] body {
        color-scheme: dark;
      }

      html[data-density="dense"] {
        --control-h: 36px;
        --space-1: 5px;
        --space-2: 8px;
        --space-3: 12px;
        --space-4: 14px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background:
          radial-gradient(1200px 700px at 15% -25%, rgba(124, 58, 237, 0.20), transparent),
          radial-gradient(900px 650px at 120% 25%, rgba(6, 182, 212, 0.18), transparent),
          radial-gradient(600px 480px at 60% 110%, rgba(34, 197, 94, 0.10), transparent),
          var(--bg);
      }

      .layout {
        display: grid;
        grid-template-columns: 76px 1fr 360px;
        min-height: 100vh;
      }

      /* Left rail */
      .rail {
        position: sticky;
        top: 0;
        height: 100vh;
        border-right: 1px solid var(--border);
        padding: var(--space-3) var(--space-2);
        display: grid;
        align-content: start;
        gap: var(--space-2);
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.10), transparent);
      }

      .rail .brand {
        height: 44px;
        border-radius: var(--radius);
        display: grid;
        place-items: center;
        border: 1px solid rgba(255, 255, 255, 0.10);
        background: radial-gradient(circle at 30% 20%, rgba(124, 58, 237, 0.92), rgba(6, 182, 212, 0.85));
        box-shadow: 0 14px 40px rgba(0, 0, 0, 0.30);
      }

      .railbtn {
        height: 44px;
        width: 44px;
        border-radius: var(--radius);
        border: 1px solid transparent;
        background: transparent;
        color: var(--text);
        cursor: pointer;
        display: grid;
        place-items: center;
      }

      .railbtn:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.10);
      }

      .railbtn[aria-current="page"] {
        background: rgba(6, 182, 212, 0.12);
        border-color: rgba(6, 182, 212, 0.28);
        box-shadow: 0 0 0 4px var(--ring);
      }

      .icon {
        width: 20px;
        height: 20px;
        opacity: 0.95;
      }

      /* Main */
      .main {
        padding: var(--space-4) var(--space-4) 48px;
        min-width: 0;
      }

      .topbar {
        max-width: 1220px;
        margin: 0 auto var(--space-3);
        display: grid;
        grid-template-columns: 1fr 1.2fr 1fr;
        align-items: center;
        gap: var(--space-3);
      }

      .title {
        min-width: 0;
      }
      .title h1 {
        margin: 0;
        font-size: 1.12rem;
        letter-spacing: -0.01em;
      }
      .title p {
        margin: var(--space-1) 0 0;
        color: var(--muted);
        font-size: 0.9rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .search {
        min-width: 0;
      }

      .control {
        height: var(--control-h);
        width: 100%;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: var(--panel-2);
        color: var(--text);
        padding: 0 12px;
        outline: none;
      }
      .control:focus {
        box-shadow: 0 0 0 4px var(--ring);
        border-color: rgba(6, 182, 212, 0.40);
      }
      .control::placeholder {
        color: color-mix(in srgb, var(--muted), transparent 25%);
      }

      .actions {
        display: flex;
        justify-content: flex-end;
        gap: var(--space-2);
        flex-wrap: wrap;
      }

      .btn {
        height: var(--control-h);
        padding: 0 12px;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
      }
      .btn.primary {
        border-color: rgba(124, 58, 237, 0.40);
        background: linear-gradient(180deg, rgba(124, 58, 237, 0.92), rgba(6, 182, 212, 0.84));
        color: #fff;
      }
      .btn:hover {
        filter: brightness(0.98);
      }
      .btn:active {
        transform: translateY(1px);
      }

      .chip {
        height: 28px;
        display: inline-flex;
        align-items: center;
        padding: 0 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.03);
        color: var(--muted);
        font-size: 0.82rem;
        white-space: nowrap;
      }

      .grid {
        max-width: 1220px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-3);
      }

      .card {
        border-radius: var(--radius-l);
        border: 1px solid var(--border);
        background: var(--panel);
        box-shadow: var(--shadow);
        padding: var(--space-3);
        min-width: 0;
      }
      .card h2 {
        margin: 0 0 var(--space-2);
        font-size: 0.98rem;
        letter-spacing: -0.01em;
      }

      /* Data table (dense + truncation) */
      .table {
        display: grid;
        gap: var(--space-2);
      }
      .row {
        display: grid;
        grid-template-columns: 1.2fr 1fr 0.8fr auto;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: var(--panel-2);
        cursor: pointer;
        min-width: 0;
      }
      .row:hover {
        border-color: color-mix(in srgb, var(--border), var(--brand-2) 25%);
      }
      .row[aria-selected="true"] {
        border-color: rgba(6, 182, 212, 0.38);
        box-shadow: 0 0 0 4px var(--ring);
      }
      .cell {
        min-width: 0;
      }
      .cell strong {
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        letter-spacing: -0.01em;
      }
      .cell small {
        display: block;
        color: var(--muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .status {
        justify-self: start;
        font-size: 0.78rem;
        font-weight: 650;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        padding: 5px 10px;
        border-radius: 999px;
        border: 1px solid transparent;
        white-space: nowrap;
      }
      .ok {
        background: rgba(34, 197, 94, 0.12);
        border-color: rgba(34, 197, 94, 0.25);
        color: color-mix(in srgb, var(--text), var(--good) 35%);
      }
      .warn {
        background: rgba(245, 158, 11, 0.12);
        border-color: rgba(245, 158, 11, 0.25);
        color: color-mix(in srgb, var(--text), var(--warn) 35%);
      }
      .bad {
        background: rgba(239, 68, 68, 0.12);
        border-color: rgba(239, 68, 68, 0.25);
        color: color-mix(in srgb, var(--text), var(--bad) 35%);
      }

      .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }

      /* Right inspector */
      .inspector {
        position: sticky;
        top: 0;
        height: 100vh;
        border-left: 1px solid var(--border);
        padding: var(--space-4) var(--space-3);
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.10), transparent);
        overflow: auto;
      }

      .inspector .panel {
        border-radius: var(--radius-l);
        border: 1px solid var(--border);
        background: var(--panel);
        box-shadow: var(--shadow);
        padding: var(--space-3);
      }

      .kv {
        display: grid;
        gap: var(--space-2);
        margin-top: var(--space-2);
      }
      .kv .item {
        min-width: 0;
      }
      .kv .k {
        color: var(--muted);
        font-size: 0.8rem;
        margin-bottom: 4px;
      }
      .kv .v {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 0.92rem;
      }

      /* Command palette */
      .palette {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 50;
        padding: 18px;
      }
      .palette.open {
        display: flex;
      }
      .palette-dialog {
        width: min(720px, 100%);
        border-radius: var(--radius-l);
        border: 1px solid var(--border);
        background: color-mix(in srgb, var(--panel), rgba(0, 0, 0, 0.08) 30%);
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.55);
        overflow: hidden;
      }
      .palette-top {
        padding: var(--space-3);
        border-bottom: 1px solid var(--border);
        display: grid;
        gap: var(--space-2);
      }
      .palette-list {
        padding: var(--space-2);
        display: grid;
        gap: 8px;
        max-height: 320px;
        overflow: auto;
      }
      .cmd {
        padding: 10px 10px;
        border-radius: var(--radius);
        border: 1px solid transparent;
        background: rgba(255, 255, 255, 0.03);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .cmd:hover {
        border-color: rgba(6, 182, 212, 0.28);
        background: rgba(6, 182, 212, 0.10);
      }
      .cmd .left {
        min-width: 0;
      }
      .cmd strong {
        display: block;
        font-size: 0.92rem;
        letter-spacing: -0.01em;
      }
      .cmd small {
        display: block;
        color: var(--muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .kbd {
        font-size: 0.78rem;
        color: var(--muted);
        border: 1px solid var(--border);
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.03);
        white-space: nowrap;
      }

      /* Responsive: collapse inspector */
      @media (max-width: 1180px) {
        .layout {
          grid-template-columns: 76px 1fr;
        }
        .inspector {
          display: none;
        }
      }

      @media (max-width: 860px) {
        .topbar {
          grid-template-columns: 1fr;
        }
        .actions {
          justify-content: flex-start;
        }
        .row {
          grid-template-columns: 1fr;
          align-items: start;
        }
      }
    </style>
  </head>
  <body>
    <div class="palette" id="palette" aria-hidden="true">
      <div class="palette-dialog" role="dialog" aria-label="Command palette">
        <div class="palette-top">
          <input
            id="palette-input"
            class="control"
            placeholder="Type a command… (e.g. scan, theme, density, logs)"
            autocomplete="off"
            spellcheck="false"
          />
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <span class="chip">Tip: Ctrl/⌘+K opens palette</span>
            <span class="chip">Esc closes</span>
          </div>
        </div>
        <div class="palette-list" id="palette-list"></div>
      </div>
    </div>

    <div class="layout">
      <aside class="rail" aria-label="Navigation rail">
        <div class="brand" title="Contiwatch" aria-hidden="true"></div>

        <button class="railbtn" data-view="status" aria-current="page" type="button" title="Status">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 12a8 8 0 1 0 16 0A8 8 0 0 0 4 12Z" stroke="currentColor" stroke-width="1.7" />
            <path d="M12 7v6l4 2" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" />
          </svg>
        </button>
        <button class="railbtn" data-view="servers" type="button" title="Servers">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M5 7h14v4H5V7Z" stroke="currentColor" stroke-width="1.7" />
            <path d="M5 13h14v4H5v-4Z" stroke="currentColor" stroke-width="1.7" />
            <path d="M8 9h.01M8 15h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round" />
          </svg>
        </button>
        <button class="railbtn" data-view="logs" type="button" title="Logs">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6 5h12v14H6V5Z" stroke="currentColor" stroke-width="1.7" />
            <path d="M9 9h6M9 12h6M9 15h4" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" />
          </svg>
        </button>
        <button class="railbtn" data-view="settings" type="button" title="Settings">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"
              stroke="currentColor"
              stroke-width="1.7"
            />
            <path
              d="M19.4 15a7.97 7.97 0 0 0 .1-1 7.97 7.97 0 0 0-.1-1l2-1.6-2-3.4-2.4 1a8.4 8.4 0 0 0-1.7-1L15 4h-6l-.3 2.9a8.4 8.4 0 0 0-1.7 1l-2.4-1-2 3.4 2 1.6a7.97 7.97 0 0 0-.1 1c0 .34.03.67.1 1l-2 1.6 2 3.4 2.4-1a8.4 8.4 0 0 0 1.7 1L9 20h6l.3-2.9a8.4 8.4 0 0 0 1.7-1l2.4 1 2-3.4-2-1.6Z"
              stroke="currentColor"
              stroke-width="1.7"
              stroke-linejoin="round"
            />
          </svg>
        </button>

        <div style="margin-top:auto; display:grid; gap: var(--space-2);">
          <button class="railbtn" id="open-palette" type="button" title="Command palette (Ctrl/⌘+K)">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 6h16M4 12h16M4 18h10" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" />
            </svg>
          </button>
        </div>
      </aside>

      <main class="main">
        <div class="topbar">
          <div class="title">
            <h1 id="title">Command Center</h1>
            <p id="subtitle">Global search + command palette + inspector panel.</p>
          </div>

          <div class="search">
            <input
              id="global-search"
              class="control"
              placeholder="Search servers / containers… (press /)"
              autocomplete="off"
              spellcheck="false"
            />
          </div>

          <div class="actions">
            <span class="chip">Release: vdev</span>
            <button class="btn" id="density-toggle" type="button" title="Density: comfortable / dense">
              Density
            </button>
            <button class="btn" id="theme-toggle" type="button" title="Theme: auto / light / dark">
              <span id="theme-label">Auto</span>
            </button>
            <button class="btn primary" id="run-scan" type="button">Run scan</button>
          </div>
        </div>

        <div class="grid">
          <section class="card view active" id="view-status" aria-label="Status view">
            <h2>Status</h2>
            <div style="display:flex; gap: var(--space-2); flex-wrap:wrap; align-items:center;">
              <span class="chip">Scheduler: off</span>
              <span class="chip">Last scan: 37s ago</span>
              <span class="chip">Updates: 3</span>
              <span class="chip">Hint: click a server row to open details</span>
            </div>
          </section>

          <section class="card view" id="view-servers" aria-label="Servers view">
            <h2>Servers</h2>
            <div class="table" id="table">
              <div class="row" data-search="local /var/run/docker.sock nginx redis" data-id="local" aria-selected="true">
                <div class="cell">
                  <strong title="local">local</strong>
                  <small title="/var/run/docker.sock" class="mono">/var/run/docker.sock</small>
                </div>
                <div class="cell">
                  <strong title="3 updates found">3 updates found</strong>
                  <small title="policy: update">policy: update</small>
                </div>
                <div class="status ok">online</div>
                <div style="display:flex; gap: var(--space-2); justify-content:flex-end; flex-wrap:wrap;">
                  <button class="btn" type="button">Details</button>
                  <button class="btn" type="button">Scan</button>
                </div>
              </div>

              <div
                class="row"
                data-search="prod-01-europe-west-very-long-name https://10.0.0.10:8080 token postgres"
                data-id="prod"
              >
                <div class="cell">
                  <strong title="prod-01-europe-west-very-long-name">prod-01-europe-west-very-long-name</strong>
                  <small title="https://10.0.0.10:8080" class="mono">https://10.0.0.10:8080</small>
                </div>
                <div class="cell">
                  <strong title="offline">offline</strong>
                  <small title="connect: i/o timeout">connect: i/o timeout</small>
                </div>
                <div class="status bad">offline</div>
                <div style="display:flex; gap: var(--space-2); justify-content:flex-end; flex-wrap:wrap;">
                  <button class="btn" type="button">Edit</button>
                  <button class="btn" type="button">Remove</button>
                </div>
              </div>

              <div class="row" data-search="staging-02 https://10.0.0.20:8080 traefik grafana" data-id="staging">
                <div class="cell">
                  <strong title="staging-02">staging-02</strong>
                  <small title="https://10.0.0.20:8080" class="mono">https://10.0.0.20:8080</small>
                </div>
                <div class="cell">
                  <strong title="scanning 12 containers">scanning 12 containers</strong>
                  <small title="policy: notify_only">policy: notify_only</small>
                </div>
                <div class="status warn">scanning</div>
                <div style="display:flex; gap: var(--space-2); justify-content:flex-end; flex-wrap:wrap;">
                  <button class="btn" type="button">Stop</button>
                  <button class="btn" type="button">Logs</button>
                </div>
              </div>
            </div>

            <div id="filter-note" style="margin-top: var(--space-2); color: var(--muted); font-size:0.9rem;">
              Use global search to filter rows. Press <span class="kbd">/</span> to focus.
            </div>
          </section>

          <section class="card view" id="view-logs" aria-label="Logs view">
            <h2>Logs</h2>
            <div
              class="mono"
              style="background: var(--panel-2); border: 1px dashed var(--border); border-radius: var(--radius); padding: var(--space-3); line-height: 1.55;"
            >
              INFO  09:22:11 scan started<br />
              INFO  09:22:12 local: 3 updates found<br />
              ERROR 09:22:13 prod-01: connect i/o timeout
            </div>
          </section>

          <section class="card view" id="view-settings" aria-label="Settings view">
            <h2>Settings</h2>
            <div style="display:grid; gap: var(--space-2);">
              <div style="display:grid; grid-template-columns: 1fr 1fr; gap: var(--space-2);">
                <div style="display:grid; gap: var(--space-1);">
                  <div style="color: var(--muted); font-size:0.82rem;">Scan interval (minutes)</div>
                  <input class="control" type="number" value="5" />
                </div>
                <div style="display:grid; gap: var(--space-1);">
                  <div style="color: var(--muted); font-size:0.82rem;">Global policy</div>
                  <select class="control">
                    <option>update</option>
                    <option>notify_only</option>
                    <option>skip</option>
                  </select>
                </div>
              </div>
              <div style="display:grid; gap: var(--space-1);">
                <div style="color: var(--muted); font-size:0.82rem;">Discord webhook URL</div>
                <input class="control" value="https://discord.com/api/webhooks/1234567890/very-long-token" />
              </div>
              <div style="display:flex; gap: var(--space-2); flex-wrap:wrap; justify-content:flex-end;">
                <button class="btn" type="button">Scheduler enabled</button>
                <button class="btn" type="button">Discord enabled</button>
                <button class="btn" type="button">Prune dangling images</button>
                <button class="btn primary" type="button">Save</button>
              </div>
            </div>
          </section>
        </div>
      </main>

      <aside class="inspector" aria-label="Inspector panel">
        <div class="panel">
          <div style="display:flex; gap: 10px; align-items:center; justify-content:space-between;">
            <div style="min-width:0;">
              <div style="color: var(--muted); font-size:0.82rem;">Selected</div>
              <div id="inspector-title" style="font-weight:700; letter-spacing:-0.01em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                local
              </div>
            </div>
            <span class="status ok" id="inspector-status">online</span>
          </div>

          <div class="kv" id="inspector-kv">
            <div class="item">
              <div class="k">Endpoint</div>
              <div class="v mono" title="/var/run/docker.sock">/var/run/docker.sock</div>
            </div>
            <div class="item">
              <div class="k">Policy</div>
              <div class="v" title="update">update</div>
            </div>
            <div class="item">
              <div class="k">Example long value</div>
              <div
                class="v mono"
                title="ghcr.io/someorg/some-image:dev_latest_with_a_very_long_tag_that_should_not_break_layout"
              >
                ghcr.io/someorg/some-image:dev_latest_with_a_very_long_tag_that_should_not_break_layout
              </div>
            </div>
            <div class="item">
              <div class="k">Actions</div>
              <div style="display:flex; gap: var(--space-2); flex-wrap:wrap;">
                <button class="btn" type="button">Scan now</button>
                <button class="btn" type="button">Restart</button>
                <button class="btn" type="button">Mute</button>
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top: var(--space-3); color: var(--muted); font-size:0.9rem; line-height:1.5;">
          Best-practice UX elements shown here:
          <ul style="margin: var(--space-2) 0 0; padding-left: 18px;">
            <li>global search (/) + command palette (Ctrl/⌘+K)</li>
            <li>consistent tokens for spacing + control height</li>
            <li>truncation + tooltips for long values</li>
            <li>inspector panel to reduce navigation churn</li>
            <li>density toggle for power users</li>
          </ul>
        </div>
      </aside>
    </div>

    <script>
      // Theme toggle: auto -> light -> dark
      const themeLabel = document.getElementById("theme-label");
      const themeBtn = document.getElementById("theme-toggle");
      const themeKey = "contiwatch_mock_theme";
      const order = ["auto", "light", "dark"];
      function applyTheme(value) {
        document.documentElement.dataset.theme = value;
        localStorage.setItem(themeKey, value);
        if (themeLabel) themeLabel.textContent = value[0].toUpperCase() + value.slice(1);
      }
      const saved = localStorage.getItem(themeKey);
      if (saved && order.includes(saved)) applyTheme(saved);
      else applyTheme("auto");
      themeBtn.addEventListener("click", () => {
        const current = document.documentElement.dataset.theme || "auto";
        const idx = order.indexOf(current);
        applyTheme(order[(idx + 1) % order.length]);
      });

      // Density toggle
      const densityBtn = document.getElementById("density-toggle");
      densityBtn.addEventListener("click", () => {
        const current = document.documentElement.dataset.density || "comfortable";
        document.documentElement.dataset.density = current === "dense" ? "comfortable" : "dense";
      });

      // View switching (rail icons)
      const railButtons = Array.from(document.querySelectorAll(".railbtn[data-view]"));
      const views = new Map(
        Array.from(document.querySelectorAll(".view")).map((el) => [
          el.id.replace("view-", ""),
          el,
        ])
      );
      const title = document.getElementById("title");
      const subtitle = document.getElementById("subtitle");
      function setView(name) {
        for (const b of railButtons) b.setAttribute("aria-current", b.dataset.view === name ? "page" : "false");
        for (const [key, el] of views.entries()) el.classList.toggle("active", key === name);
        if (title) title.textContent = name[0].toUpperCase() + name.slice(1);
        if (subtitle) {
          const map = {
            status: "Quick overview + KPI chips.",
            servers: "Filterable server list + inspector panel.",
            logs: "Readable logs with monospace surface.",
            settings: "Compact settings layout with consistent controls.",
          };
          subtitle.textContent = map[name] || "—";
        }
      }
      for (const b of railButtons) b.addEventListener("click", () => setView(b.dataset.view));

      // Global search filters server rows (and can auto-switch to Servers view)
      const globalSearch = document.getElementById("global-search");
      const rows = Array.from(document.querySelectorAll(".row[data-search]"));
      const filterNote = document.getElementById("filter-note");
      function normalize(s) {
        return (s || "").toLowerCase().trim();
      }
      function applyRowFilter(q) {
        const query = normalize(q);
        let visible = 0;
        for (const r of rows) {
          const hay = normalize(r.getAttribute("data-search"));
          const match = !query || hay.includes(query);
          r.style.display = match ? "" : "none";
          if (match) visible += 1;
        }
        if (filterNote) {
          filterNote.textContent =
            query.length === 0
              ? "Use global search to filter rows. Press / to focus."
              : `Filter: “${q}” — showing ${visible} row(s).`;
        }
      }
      globalSearch.addEventListener("input", (e) => {
        setView("servers");
        applyRowFilter(e.target.value);
      });

      // Inspector selection
      const inspectorTitle = document.getElementById("inspector-title");
      const inspectorStatus = document.getElementById("inspector-status");
      const inspectorKV = document.getElementById("inspector-kv");
      const dataset = {
        local: {
          status: "online",
          statusClass: "ok",
          endpoint: "/var/run/docker.sock",
          policy: "update",
          long: "ghcr.io/someorg/some-image:dev_latest_with_a_very_long_tag_that_should_not_break_layout",
        },
        prod: {
          status: "offline",
          statusClass: "bad",
          endpoint: "https://10.0.0.10:8080",
          policy: "update",
          long: "connect: dial tcp 10.0.0.10:8080: i/o timeout",
        },
        staging: {
          status: "scanning",
          statusClass: "warn",
          endpoint: "https://10.0.0.20:8080",
          policy: "notify_only",
          long: "12 containers currently scanning…",
        },
      };
      function selectRow(id) {
        for (const r of rows) r.setAttribute("aria-selected", r.dataset.id === id ? "true" : "false");
        const data = dataset[id] || dataset.local;
        if (inspectorTitle) inspectorTitle.textContent = id;
        if (inspectorStatus) {
          inspectorStatus.textContent = data.status;
          inspectorStatus.className = `status ${data.statusClass}`;
        }
        if (inspectorKV) {
          inspectorKV.querySelectorAll("[data-bind]").forEach((el) => {
            const key = el.getAttribute("data-bind");
            el.textContent = data[key] || "";
            el.title = data[key] || "";
          });
        }
      }
      for (const r of rows) r.addEventListener("click", () => selectRow(r.dataset.id));

      // Bind inspector values (simple)
      inspectorKV?.querySelector(".v.mono")?.setAttribute("data-bind", "endpoint");
      inspectorKV?.querySelectorAll(".item .v")[1]?.setAttribute("data-bind", "policy");
      inspectorKV?.querySelectorAll(".item .v")[2]?.setAttribute("data-bind", "long");
      selectRow("local");
      setView("status");

      // Command palette
      const palette = document.getElementById("palette");
      const paletteInput = document.getElementById("palette-input");
      const paletteList = document.getElementById("palette-list");
      const openPaletteBtn = document.getElementById("open-palette");

      const commands = [
        {
          name: "Run scan",
          desc: "Start a scan now",
          kbd: "Enter",
          run: () => alert("Mock: scan started"),
        },
        {
          name: "Go to Status",
          desc: "Open overview",
          kbd: "1",
          run: () => setView("status"),
        },
        { name: "Go to Servers", desc: "Open servers list", kbd: "2", run: () => setView("servers") },
        { name: "Go to Logs", desc: "Open logs", kbd: "3", run: () => setView("logs") },
        { name: "Go to Settings", desc: "Open settings", kbd: "4", run: () => setView("settings") },
        {
          name: "Toggle theme",
          desc: "Auto / light / dark",
          kbd: "T",
          run: () => themeBtn.click(),
        },
        {
          name: "Toggle density",
          desc: "Comfortable / dense",
          kbd: "D",
          run: () => densityBtn.click(),
        },
      ];

      function openPalette() {
        palette.classList.add("open");
        palette.setAttribute("aria-hidden", "false");
        renderCommands("");
        paletteInput.value = "";
        setTimeout(() => paletteInput.focus(), 0);
      }
      function closePalette() {
        palette.classList.remove("open");
        palette.setAttribute("aria-hidden", "true");
      }

      function renderCommands(q) {
        const query = normalize(q);
        const filtered = commands.filter(
          (c) => !query || normalize(c.name + " " + c.desc).includes(query)
        );
        paletteList.innerHTML = "";
        for (const c of filtered) {
          const el = document.createElement("div");
          el.className = "cmd";
          el.tabIndex = 0;
          el.innerHTML = `
            <div class="left">
              <strong>${c.name}</strong>
              <small>${c.desc}</small>
            </div>
            <span class="kbd">${c.kbd}</span>
          `;
          el.addEventListener("click", () => {
            closePalette();
            c.run();
          });
          paletteList.appendChild(el);
        }
      }

      palette.addEventListener("click", (e) => {
        if (e.target === palette) closePalette();
      });
      paletteInput.addEventListener("input", (e) => renderCommands(e.target.value));
      openPaletteBtn.addEventListener("click", openPalette);

      document.addEventListener("keydown", (e) => {
        const meta = e.metaKey || e.ctrlKey;
        if (meta && e.key.toLowerCase() === "k") {
          e.preventDefault();
          openPalette();
        }
        if (e.key === "Escape") closePalette();
        if (e.key === "/") {
          const active = document.activeElement;
          const isTyping =
            active &&
            (active.tagName === "INPUT" ||
              active.tagName === "TEXTAREA" ||
              active.tagName === "SELECT" ||
              active.isContentEditable);
          if (!isTyping) {
            e.preventDefault();
            globalSearch.focus();
          }
        }
        if (e.key === "1") setView("status");
        if (e.key === "2") setView("servers");
        if (e.key === "3") setView("logs");
        if (e.key === "4") setView("settings");
      });
    </script>
  </body>
</html>
